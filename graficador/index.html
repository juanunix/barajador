<!DOCTYPE html>
<html lang="es">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Ey Pacha!">
    <link rel="icon" href="../favicon.png">
    
    <title>Graficador</title>

    <!-- Open Graph -->
    <meta property="og:locale" content="es_ES" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:image" content="" />
    
<style type="text/css">
body { 
    background-color: #40001b;
    background-image: url("../img/table/suits-light.png");
    text-align: center;
    margin:0px 0px;
}

canvas {
    border: 1px solid black;
    -webkit-border-radius: 15px;
    -moz-border-radius: 15px;
    border-radius: 15px;
    background: white;
}
label {
    border: 1px solid grey;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    padding:2px;
    vertical-align:middle;
    background:white;
}

#mostrar-ciclos label {
    font-weight: bold;
    display: none;
}
#inpEspacio {
    width: 30px;
    text-align: center;
}
#preferencias {
    background: silver;
    padding: 5px 0px;
    margin-bottom:20px;
    -webkit-box-shadow: 0px 4px 10px 0px rgba(0,0,0,0.5);
    -moz-box-shadow: 0px 4px 10px 0px rgba(0,0,0,0.5);
    box-shadow: 0px 4px 10px 0px rgba(0,0,0,0.5);
}
</style>
</head>

<body>

<div id="preferencias">Ciclos:
 <span id="mostrar-ciclos">
     <label id="l1"><span id="s1">1</span> <input type="checkbox" id="inp1" checked onChange="dibujar()"></label>
     <label id="l2"><span id="s2">2</span> <input type="checkbox" id="inp2" checked onChange="dibujar()"></label>
     <label id="l3"><span id="s3">3</span> <input type="checkbox" id="inp3" checked onChange="dibujar()"></label>
     <label id="l4"><span id="s4">4</span> <input type="checkbox" id="inp4" checked onChange="dibujar()"></label>
     <label id="l5"><span id="s5">5</span> <input type="checkbox" id="inp5" checked onChange="dibujar()"></label>
     <label id="l6"><span id="s6">6</span> <input type="checkbox" id="inp6" checked onChange="dibujar()"></label>
     <label id="l7"><span id="s7">7</span> <input type="checkbox" id="inp7" checked onChange="dibujar()"></label>
     <label id="l8"><span id="s8">8</span> <input type="checkbox" id="inp8" checked onChange="dibujar()"></label>
     <label id="l9"><span id="s9">9</span> <input type="checkbox" id="inp9" checked onChange="dibujar()"></label>
     <label id="l10"><span id="s10">10</span> <input type="checkbox" id="inp10" checked onChange="dibujar()"></label>
     <label id="l11"><span id="s11">11</span> <input type="checkbox" id="inp11" checked onChange="dibujar()"></label>
     <label id="l12"><span id="s12">12</span> <input type="checkbox" id="inp12" checked onChange="dibujar()"></label>
     <label id="l13"><span id="s13">13</span> <input type="checkbox" id="inp13" checked onChange="dibujar()"></label>
     <label id="l14"><span id="s14">14</span> <input type="checkbox" id="inp14" checked onChange="dibujar()"></label>
     <label id="l15"><span id="s15">15</span> <input type="checkbox" id="inp15" checked onChange="dibujar()"></label>
     <label id="l16"><span id="s16">15</span> <input type="checkbox" id="inp16" checked onChange="dibujar()"></label>
     <label id="l17"><span id="s17">15</span> <input type="checkbox" id="inp17" checked onChange="dibujar()"></label>
     <label id="l18"><span id="s18">15</span> <input type="checkbox" id="inp18" checked onChange="dibujar()"></label>
     <label id="l19"><span id="s19">15</span> <input type="checkbox" id="inp19" checked onChange="dibujar()"></label>
     <label id="l20"><span id="s20">15</span> <input type="checkbox" id="inp20" checked onChange="dibujar()"></label>
 </span>
 Zoom: <input id="inpEspacio" type="number" min="1" max="20" value="15" onChange="dibujar()">
 <label>Posiciones:<input type="checkbox" id="inpPosiciones" checked onChange="dibujar()"></label>
 <label>R&oacute;tulos:<input type="checkbox" id="inpRotulos" checked onChange="dibujar()"></label>
 <label>Circular:<input type="checkbox" id="inpRadial" onChange="dibujar()"></label>

</div>

<canvas id="grafico" width="800" height="500"></canvas>
    
<script>
var orden = getQueryVariable("orden");
    orden = orden.split(",");
var colores = ["#bf2330","#0ff","#0f0","#00f","#ff0","#f0f","#f00","#888","#7c0741","#280b5d","#146961","#98cb3e","#ef6f2d","#186c68"];
var oCanvas = document.getElementById("grafico");
var cxt = oCanvas.getContext("2d");
var pY = 250;
var centroX = (800/2);
var centroY = (500/2);
var factores;

    
// Dibuja cada mezcla
function dM(inicial,final){
  
  if (inicial > final) {
    var tmp = inicial;
    inicial = final;
    final = tmp;
    var signo = "-";
  } else {
    var signo = "+";
    }

  if (document.getElementById("inpRadial").checked){
  // Lineas
  cxt.beginPath();
  posX = centroX + Math.cos(alfa * inicial + modif) * radio;
  posY = centroY + Math.sin(alfa * inicial + modif) * radio;
  cxt.moveTo(posX,posY);
  posX = centroX + Math.cos(alfa * final + modif) * radio;
  posY = centroY + Math.sin(alfa * final + modif) * radio;
  cxt.lineTo(posX,posY);
  cxt.stroke();
  }else{

  // Arcos
  diametro = final - inicial;
  pX = margenX + inicial * dotEspacio -  dotEspacio / 2 + (diametro-1) * dotEspacio/2;
  pD = diametro * dotEspacio / 2;
  cxt.beginPath();
  cxt.arc(pX,pY,pD,0,Math.PI,dir=!dir);
  cxt.stroke();
  }

  // Rótulos
  rotYmargen = 8
  if (document.getElementById("inpRotulos").checked && !document.getElementById("inpRadial").checked){

    disY = (diametro) * dotEspacio/2;
    if (dir){
        rotpY = pY - disY - rotYmargen;
    } else {
        rotpY = pY + disY + 4 + rotYmargen;
    }
    
    cxt.fillStyle ="white";
    cxt.beginPath();
    cxt.arc(pX,rotpY-2,10,0,Math.PI*2,true);
    cxt.closePath();
    cxt.fill();
    cxt.stroke();
    cxt.fillStyle ="black";
    cxt.beginPath();
    cxt.font = "bold 10px Georgia";
    cxt.textAlign = "center";
    cxt.fillText(signo+diametro,pX,rotpY);
 }

}

// Dibuja cada ciclo
function dCiclo(nums){

  nums = nums.split(",");
  dir = false;

  for(var i=0;i < nums.length; i++){

    dM(parseInt(nums[i]),parseInt(nums[(i+1)%nums.length]));

  }

}

function dibujar(){
  // Primero borra el dibujo anterior
  cxt.fillStyle = "white";
  cxt.fillRect(0, 0, oCanvas.width, oCanvas.height);

  // Lee las preferencias
  dotEspacio = document.getElementById("inpEspacio").value;
  margenX = (800/2) - (orden.length * dotEspacio)/2;
  alfa = Math.PI*2 / orden.length;
  modif = alfa * orden.length/2;
  radio = 200;
  porSecuencia();
  // Dibuja los puntos por cada carta


  for(var i=0;i < orden.length; i++){
    
    cxt.fillStyle ="black";
    cxt.beginPath();
    if (document.getElementById("inpRadial").checked){
      posX = centroX + Math.cos(alfa * i + modif) * radio;
      posY = centroY + Math.sin(alfa * i + modif) * radio;
      cxt.arc(posX,posY,1.5,0,Math.PI*2,true);
    }else{
      var pX = margenX + dotEspacio * i;
      cxt.arc(pX,pY,1.5,0,Math.PI*2,true);
    }
    
    cxt.closePath();
    cxt.fill();
    
    if (document.getElementById("inpPosiciones").checked){
      cxt.font = "10px Georgia";
      cxt.fillStyle = "black";
      cxt.textAlign = "center";
      if (document.getElementById("inpRadial").checked){
        cxt.fillText(i+1,posX,posY+10);
      }else{
	cxt.fillText(i+1,pX,pY+10);
      }
    }
  }

  // mostrando la matriz graficada
  cxt.font = "12px Georgia";
  cxt.fillStyle = "black";
  cxt.textAlign = "left";
  cxt.fillText(orden,10,25);
    
  // Creando la partición de lambda(x)
  cxt.font = "14px Georgia";
  cxt.fillStyle = "black";
  cxt.textAlign = "right";
  num = String(orden.length);
  subs = "₀₁₂₃₄₅₆₇₈₉".split("");
  for(var i=0;i<10;i++){
    var re = new RegExp(i, "g");
    num = num.replace(re,subs[i]);
  }
  
  cxt.fillText("λ₍"+num+"₎=("+factores.sort(function(a, b){return b - a;})+")",790,480);

}
    
function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}
    
function porSecuencia(){

tempO = orden.slice();
var e = 1;
var ciclos = [];
factores = [];
    
do{

    // Rastrea un ciclo
    var ciclo = [e];
    var v = e;
    var max = 0;
    while (parseInt(orden[v-1]) != e || max > orden.length ){

     ciclo.push(orden[v-1]);
     tempO[v-1] = 0;
     v = orden[v-1];
     max++;

    }
    tempO[v-1] =  0;

    ciclos.push(ciclo.toString());
    
    factores.push(ciclo.length);
 
    
    // Dibuja el ciclo si tiene más de un paso
    if (ciclo.length != 1){
        
        document.getElementById("l"+(ciclos.length)).style.color = colores[ciclos.length-1];
        document.getElementById("s"+(ciclos.length)).innerHTML = ciclo[0];
         document.getElementById("l"+(ciclos.length)).style.display = "inline-block";    
        if (document.getElementById("inp"+(ciclos.length)).checked){
            cxt.strokeStyle = colores[ciclos.length-1];
            dCiclo(ciclo.toString());
        }
        
    } else 
    {
        // Oculta los ciclos e 1 paso
    
    }
    
    // Define el siguiente ciclo a buscar
    do{e++} while(tempO[e-1] == 0);
        
} while (e <= orden.length);

}

dibujar();
</script>
</body>

</html>
